in AccountReceivableDetailStateMachine:
    injected applyRequirementEventPublisher
    injected paymentRequirementOutboxService

    describe sendBalanceRequirementEvent with params context: StateContext
        let are = ...;
        let eventName = ...;
        try   H do
            publish applyRequirementEventPublisher  are
            create  paymentRequirementOutboxService are eventName Status.SENT
        catch H do
              do create  paymentRequirementOutboxService are eventName Status.FAILED

in PaymentRequirementOutboxScheduler:
    injected paymentRequirementOutboxRepository
    injected paymentRequirementPublisherService
    injected configData

    describe processOutboxMessage -> () / transactional, scheduled
        try do
            let   outboxMessages = [...]
            match outboxMessages =
                | Maybe.empty               = return ()
                | messages where List.empty = return ()
                | messages                  = unwrap

            try   (fjp = ForkJoinPool new) do
                parallelForEach messages -> message do
                    try paymentRequirementPublisherService.publish message
                    catch e logError
            finally fjp shutdown
        catch e logError

in PaymentRequirementPublisherService
    injected objectMapper
    injected publisher <- quÃ© es este publisher?
    injected paymentRequirementOutboxRepository

    describe publish for message: PaymentRequirementOutbox -> () / transactional
        try do
            let payload = objectMapper.readValue message.payload ApplyRequirementEvent.class
            let outbox  = PaymentRequirementOutbox.builder do
                // RE-CREATE OUTBOX
                build

            publisher.publish? outbox
            paymentRequirementOutboxRepository.updateStatusByOutboxId Status.SENT, message.dbid
            log "Succesfully republished payment requirement message for payment: {}"
                message.applyrequirementeventdbid <- what goes here?
        catch e do
            logError "Error republishing payment requirement message for payment: {}, error: {}"
                     message.applyrequirementeventdbid? e.message e
            paymentRequirementOutboxRepository.updateStatusByOutboxId Status.FAILED, message.dbid