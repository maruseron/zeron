@ExtendWith(Mockito.class)
in PaymentRequirementOutboxServiceTest:

           mock  repository
           mock  outboxPublisher
    inject mocks service
               { createPaymentOutboxRequirement(ApplyRequirementEvent) }

    describe test whenService_isSuccessful_thenCreateSentOutbox()
        arrange
            prepare ApplyRequirementEvent

        act
            call service createPaymentOutboxRequirement with ApplyRequirementEvent

        assert
            verify repository      save    was called once
                                   with any PaymentOutboxRequirement
            verify outboxPublisher publish was called once
                                   with any PaymentOutboxRequirement
    }

@ExtendWith(Mockito.class)
in PaymentRequirementPublisherServiceTest:

           mock  repository
           mock  publisher
    inject mocks service
               { publish(PaymentRequirementOutbox) }

    describe test whenService_isSuccessful_thenCreateSentOutbox()
        arrange
            prepare PaymentRequirementOutbox

        act
            call service publish PaymentRequirementOutbox

        assert
            verify publisher  publishEvent           was called once
                              with any ApplyRequirementEvent
            verify repository updateStatusByOutboxId was called once
                              with OutboxStatus.SENT
                               and any long

    describe test whenService_fails_thenCreateFailedOutbox()
        arrange
            prepare PaymentRequirementOutbox
            prepare publisher to throw

        act
            call service publish PaymentRequirementOutbox

        assert
            verify repository updateStatusByOutboxId was called once
                              with OutboxStatus.FAILED
                               and any long